<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Award List Portal - G.P.S SALOBAIG</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --zong-pink: #df1b77; --zong-green: #8cc63f; --bg: #f0f2f5; --save-blue: #007bff; --danger: #dc3545; --dark-slate: #2c3e50; }
        * { box-sizing: border-box; -webkit-print-color-adjust: exact; }
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: var(--bg); margin: 0; }

        /* Comprehensive Executive Guide Styling */
        .executive-guide { 
            background: #ffffff; 
            margin: 20px auto; 
            max-width: 500px;
            border-radius: 12px; 
            border: 1px solid #d1d5db;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .guide-banner {
            background: var(--dark-slate);
            color: #ffffff;
            padding: 12px 20px;
            font-size: 13px;
            letter-spacing: 1px;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .guide-body { padding: 20px; }
        .guide-section { margin-bottom: 20px; }
        .guide-section:last-child { margin-bottom: 0; }
        .guide-title { 
            color: var(--zong-pink); 
            font-size: 11px; 
            font-weight: 800; 
            text-transform: uppercase; 
            margin-bottom: 8px; 
            display: flex; 
            align-items: center; 
            gap: 6px;
            border-bottom: 1px solid #eee;
            padding-bottom: 4px;
        }
        .guide-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .guide-text { 
            color: #4b5563; 
            font-size: 11px; 
            line-height: 1.5; 
            margin: 0 0 5px 0; 
            padding-left: 15px;
            position: relative;
        }
        .guide-text::before {
            content: "";
            position: absolute;
            left: 0;
            color: var(--zong-green);
            font-weight: bold;
        }
        .highlight { color: #000; font-weight: 700; }

        /* Table inside guide for Class marks info */
        .guide-table { width: 100%; border-collapse: collapse; margin-top: 5px; font-size: 10px; }
        .guide-table th { text-align: left; color: #999; font-weight: 600; padding: 2px 0; }
        .guide-table td { padding: 2px 0; color: #444; }

        .app-view { max-width: 500px; margin: 0 auto; background: #fff; min-height: 100vh; padding-bottom: 20px; border: 1px solid #ddd; display: flex; flex-direction: column; }
        .app-header { background: linear-gradient(135deg, var(--zong-pink), #9d1252); color: white; padding: 15px; text-align: center; }
        .edit-head { width: 100%; background: rgba(255,255,255,0.15); border: 1px dashed white; color: white; text-align: center; border-radius: 5px; margin-bottom: 5px; padding: 5px; font-weight: bold; outline: none; }
        
        .top-nav { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 10px; background: #fff; border-bottom: 2px solid #eee; position: sticky; top: 0; z-index: 100; }
        .btn { padding: 10px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 12px; }

        .form-section { padding: 15px; flex-grow: 1; }
        .student-card { background: white; padding: 15px; border-radius: 15px; border: 1.5px solid #ddd; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .input-box { width: 100%; padding: 12px; margin-bottom: 10px; border: 1.2px solid #ccc; border-radius: 10px; font-size: 16px; font-weight: 600; outline: none; }

        .subjects-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 15px; }
        .sub-card { background: #fdfdfd; border: 1px solid #eee; padding: 8px; border-radius: 10px; text-align: center; }
        .sub-card label { display: block; font-size: 10px; font-weight: 900; margin-bottom: 2px; color: var(--zong-green); }
        .sub-card.locked label { color: var(--danger) !important; }
        .sub-card.locked { opacity: 0.6; background: #f2f2f2; }
        .sub-card input { width: 100%; border: none; background: transparent; text-align: center; font-size: 18px; font-weight: bold; outline: none; }
        
        .total-box { margin-top: 15px; padding: 10px; background: #f8f8f8; border-radius: 10px; text-align: center; font-weight: 900; border: 2px solid var(--zong-green); }
        .live-status { font-size: 12px; padding: 2px 8px; border-radius: 5px; color: white; margin-left: 10px; vertical-align: middle; }

        .nav-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 25px; padding: 0 10px; }
        .nav-btn { background: #444; color: white; border: none; padding: 12px 18px; border-radius: 30px; font-weight: 900; cursor: pointer; font-size: 13px; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .nav-btn:active { transform: scale(0.95); background: var(--zong-pink); }

        .app-footer { text-align: center; padding: 15px 10px; margin-top: 20px; border-top: 1px solid #eee; color: #666; font-size: 13px; }
        .app-footer strong { color: var(--zong-pink); }
        .app-footer .wa-link { color: #25D366; text-decoration: none; font-size: 16px; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 8px; }

        .sig-settings { margin-top: 15px; padding: 10px; background: #f9f9f9; border-radius: 10px; border: 1px solid #ddd; }
        .sig-settings label { font-size: 11px; font-weight: bold; color: #555; }
        .sig-input { width: 100%; padding: 5px; margin-bottom: 5px; border: 1px solid #ccc; border-radius: 4px; font-size: 12px; }

        /* Print Settings */
        #dynamic-print-container { display: none; }

        @media print {
            .no-print { display: none !important; }
            #dynamic-print-container { display: block !important; width: 100%; }
            .print-page { page-break-after: always; padding: 5mm; background: white; }
            .a4-head { text-align: center; text-decoration: underline; font-size: 16pt; font-weight: 900; margin-bottom: 10px; }
            .a4-info-bar { display: flex; justify-content: space-between; align-items: center; font-weight: 900; font-size: 9.5pt; margin-bottom: 8px; padding: 5px 2px; border-bottom: 2px solid black; }
            table { width: 100%; border-collapse: collapse; border: 2px solid black; }
            th, td { border: 1px solid black; text-align: center; padding: 4px; font-size: 8.5pt; font-weight: 900; height: 26px; }
            .total-cell { background-color: #f2f2f2 !important; font-weight: bold; border-right: 2px solid black; }
            .fail-text { color: var(--danger) !important; font-size: 6.5pt; display: block; line-height: 0.8; font-weight: bold; }
            .print-stats-bottom { font-weight: 900; font-size: 10pt; margin-top: 15px; display: flex; justify-content: space-around; border-top: 1px dashed #000; padding-top: 10px; }
            .signature-row { display: flex; justify-content: space-around; margin-top: 40px; gap: 20px; }
            .sig-box { border-top: 1.5px solid black; width: 150px; text-align: center; font-weight: bold; font-size: 9pt; padding-top: 5px; }
        }
    </style>
</head>
<body>

<div class="executive-guide no-print">
    <div class="guide-banner">
        <span><i class="fas fa-info-circle"></i> SYSTEM HANDBOOK & BASIC INFORMATION</span>
    </div>
    <div class="guide-body">
        
        <div class="guide-section">
            <div class="guide-title"><i class="fas fa-play-circle"></i> GETTING STARTED</div>
            <div class="guide-grid">
                <div>
                    <p class="guide-text"><span class="highlight">Step 1:</span> Select the <strong>Class</strong> and <strong>Exam Mode</strong> (1st Sem or Annual) from the dropdown menus.</p>
                    <p class="guide-text"><span class="highlight">Step 2:</span> Enter Student Name. Father's Name is optional but recommended for records.</p>
                </div>
                <div>
                    <p class="guide-text"><span class="highlight">Step 3:</span> Enter marks. For 1st Sem, the system <strong>auto-calculates 45%</strong>. For Annual, enter 100% raw marks.</p>
                    <p class="guide-text"><span class="highlight">Step 4:</span> Click <strong>Next</strong> to move to the next roll number. Data is saved automatically.</p>
                </div>
            </div>
        </div>

        <div class="guide-section">
            <div class="guide-title"><i class="fas fa-graduation-cap"></i> PASSING CRITERIA</div>
            <div style="background: #fff9fb; border: 1px solid #fce7f3; padding: 12px; border-radius: 8px;">
                <p class="guide-text" style="margin-bottom: 5px;"><span class="highlight">The 33% Rule:</span> A student is marked <strong>PASS</strong> if their total aggregate meets or exceeds 33% of the total marks.</p>
                <p class="guide-text"><span class="highlight">Automated Fail:</span> Any student with a total below the threshold is highlighted in <strong>RED</strong> on the final award list.</p>
            </div>
        </div>

        <div class="guide-section">
            <div class="guide-title"><i class="fas fa-print"></i> EXPORT & STORAGE</div>
            <div class="guide-grid">
                <div>
                    <p class="guide-text"><span class="highlight">Save PDF:</span> Uses A4 formatting. It is designed to fit <strong>30 students</strong> perfectly on one page.</p>
                </div>
                <div>
                    <p class="guide-text"><span class="highlight">Privacy:</span> Data is stored <strong>locally on your device</strong>. Clearing browser cache will delete the data.</p>
                </div>
            </div>
        </div>

        <div class="guide-section">
            <div class="guide-title"><i class="fas fa-book"></i> SUBJECT KEY</div>
            <div style="font-size: 10px; color: #64748b; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; padding: 10px; background: #f8fafc; border-radius: 8px;">
                <span><strong>ENG:</strong> English</span>
                <span><strong>URD:</strong> Urdu</span>
                <span><strong>MAT:</strong> Mathematics</span>
                <span><strong>SCI:</strong> Science</span>
                <span><strong>ISL:</strong> Islamiat</span>
                <span><strong>NQ:</strong> Nazra Quran</span>
                <span><strong>PSH:</strong> Pashto</span>
                <span><strong>S.S:</strong> Social Studies</span>
                <span><strong>ARB:</strong> Arabic</span>
            </div>
        </div>
    </div>
</div>


<div class="app-view no-print">
    <div class="app-header">
        <input type="text" id="edit-school" class="edit-head" value="G.P.S SALOBAIG" oninput="renderTable()">
        <input type="text" id="edit-title" class="edit-head" value="STUDENT AWARD LIST - 2026" oninput="renderTable()">
    </div>

    <div class="top-nav">
        <button class="btn" style="background:var(--save-blue)" onclick="saveToDisk()"><i class="fas fa-save"></i> SAVED</button>
        <button class="btn" style="background:var(--zong-green)" onclick="window.print()"><i class="fas fa-print"></i> Save PDF</button>
        <button class="btn" style="background:orange; color:black" onclick="clearCurrentRow()"><i class="fas fa-user-slash"></i> CLEAR</button>
        <button class="btn" style="background:var(--danger)" onclick="deleteWholeClass()"><i class="fas fa-trash"></i> RESET</button>
    </div>

    <div class="form-section">
        <div style="display:flex; flex-direction:column; gap:8px; margin-bottom:15px;">
            <div style="display:flex; gap:8px;">
                <select id="classSel" onchange="changeClass(this.value)" style="flex:1.5; padding:10px; border-radius:8px; font-weight:bold;">
                    <option value="KG">Class: KG</option>
                    <option value="1ST">Class: 1ST</option>
                    <option value="2ND">Class: 2ND</option>
                    <option value="3RD">Class: 3RD</option>
                    <option value="4TH">Class: 4TH</option>
                    <option value="5TH">Class: 5TH</option>
                    <option value="6TH">Class: 6TH</option>
                    <option value="7TH">Class: 7TH</option>
                    <option value="8TH">Class: 8TH</option>
                </select>
                <input type="text" id="sectionInp" placeholder="Sec" value="A" oninput="renderTable()" style="width:50px; padding:10px; border-radius:8px; font-weight:bold; text-align:center; border:1px solid #ccc;">
                <select id="modeSel" onchange="changeMode(this.value)" style="flex:2; padding:10px; border-radius:8px; font-weight:bold;">
                    <option value="1st">1st Sem (45%)</option>
                    <option value="Final">Annual exam</option>
                </select>
            </div>
            
            <div id="percCont" style="display: none; margin-top: 5px;">
                <select id="percSel" onchange="changePerc(this.value)" style="width:100%; padding:10px; border-radius:8px; font-weight:bold; border: 2px solid var(--zong-green);">
                </select>
            </div>
            
            <div class="sig-settings">
                <label>Edit Signature Titles:</label>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-top:5px;">
                    <input type="text" id="sig1-edit" class="sig-input" value="Class Teacher" oninput="renderTable()">
                    <input type="text" id="sig2-edit" class="sig-input" value="Head Master" oninput="renderTable()">
                </div>
                <div id="sig3-cont" style="display:none">
                    <input type="text" id="sig3-edit" class="sig-input" value="Controller of Exam" oninput="renderTable()">
                </div>
            </div>
        </div>

        <div class="student-card">
            <div id="roll-info" style="font-weight:900; color:var(--zong-pink); margin-bottom:10px;">Roll No: 1</div>
            <input type="text" id="sName" class="input-box" placeholder="Student Name" oninput="updateData('n', this.value)">
            <input type="text" id="fName" class="input-box" placeholder="Father Name" oninput="updateData('f', this.value)">
            <div class="subjects-grid" id="subGrid"></div>
            <div id="total-container" class="total-box">
                TOTAL: <span id="live-total" style="color:var(--zong-pink); font-size:22px;">0</span>
                <span id="live-status" class="live-status"></span>
            </div>
        </div>

        <div class="nav-controls">
            <button class="nav-btn" onclick="nav(-1)"><i class="fas fa-chevron-left"></i> PREVIOUS</button>
            <span id="page-indicator" style="font-weight:900; font-size:18px; color:#444;">1 / 100</span>
            <button class="nav-btn" onclick="nav(1)">NEXT <i class="fas fa-chevron-right"></i></button>
        </div>
    </div>
    
    <footer class="app-footer no-print">
        Developed by: <strong>Sajjad Ali Humdard</strong>
        <a href="https://wa.me/923073736743" class="wa-link">
            <i class="fab fa-whatsapp"></i> Help support
        </a>
    </footer>
</div>

<div id="dynamic-print-container"></div>

<script>
    let WEIGHT = 0.45, PASS_THRESHOLD = 0.33, currentMode = "1st", currentClass = "KG", activeIdx = 0, maxReachedIdx = 0, students = [];

    function getStoreKey() { return 'AwardData_ModeSplit_' + currentClass + '_' + currentMode; }
    
    function getPassCriteria() {
        let maxMarks = (currentClass === "KG") ? 500 : (["1ST", "2ND", "3RD"].includes(currentClass)) ? 700 : (["4TH", "5TH"].includes(currentClass)) ? 800 : 900;
        return maxMarks * WEIGHT * PASS_THRESHOLD;
    }

    function updatePercOptions() {
        const container = document.getElementById('percCont');
        if(currentMode === "Final") {
            container.style.display = "block";
            document.getElementById('percSel').innerHTML = '';
            for(let i=10; i<=45; i++) {
                let opt = document.createElement('option');
                opt.value = i/100; opt.innerHTML = `Set Passing Marks: ${i}%`;
                if(i === 33) opt.selected = true;
                document.getElementById('percSel').appendChild(opt);
            }
        } else { container.style.display = "none"; PASS_THRESHOLD = 0.33; }
    }

    function getSubjects() {
        if (["1ST", "2ND", "3RD"].includes(currentClass)) return ["ENG","URD","MAT","G.K","ISL","NQ","PSH","S.S","D.G"];
        if (["6TH", "7TH", "8TH"].includes(currentClass)) return ["ENG","URD","MAT","SCI","ISL","ARB","HIS","GEO","COMP"];
        return ["ENG","URD","MAT","SCI","ISL","NQ","PSH","S.S","D.G"];
    }

    function isLocked(mi) {
        if (currentClass === "KG") return [3, 4, 5, 7].includes(mi);
        if (["1ST", "2ND", "3RD"].includes(currentClass)) return [7].includes(mi);
        return false;
    }

    function init() {
        let saved = JSON.parse(localStorage.getItem(getStoreKey()));
        students = saved || Array.from({length: 100}, () => ({n:'', f:'', m:Array(9).fill('')}));
        let lastFilled = 0; students.forEach((s, i) => { if(s.n || s.f) lastFilled = i; });
        maxReachedIdx = lastFilled;
        const subjects = getSubjects();
        document.getElementById('subGrid').innerHTML = subjects.map((s, i) => `
            <div class="sub-card ${isLocked(i)?'locked':''}">
                <label>${s}</label>
                <input type="text" inputmode="decimal" id="m-${i}" onblur="manualMarkEntry(${i}, this.value)" ${isLocked(i)?'disabled':''}>
            </div>`).join('');
        document.getElementById('sig3-cont').style.display = ["6TH", "7TH", "8TH"].includes(currentClass) ? 'block' : 'none';
        load(activeIdx);
    }

    function load(idx) {
        activeIdx = idx; if(idx > maxReachedIdx) maxReachedIdx = idx;
        const s = students[activeIdx];
        document.getElementById('roll-info').innerText = "Roll No: " + (idx + 1);
        document.getElementById('page-indicator').innerText = (idx + 1) + " / 100";
        document.getElementById('sName').value = s.n || "";
        document.getElementById('fName').value = s.f || "";
        getSubjects().forEach((_, i) => { let input = document.getElementById(`m-${i}`); if(input) input.value = s.m[i] || ""; });
        updateLiveTotal(); renderTable();
    }

    function manualMarkEntry(mi, val) {
        if(val === "") { students[activeIdx].m[mi] = ''; } 
        else { let finalVal = (currentMode === "1st") ? (parseFloat(val) * 0.45).toFixed(1) : val; students[activeIdx].m[mi] = finalVal; document.getElementById(`m-${mi}`).value = finalVal; }
        updateLiveTotal(); renderTable(); saveToDisk();
    }

    function updateLiveTotal() {
        let total = students[activeIdx].m.reduce((a, b) => a + (parseFloat(b) || 0), 0);
        document.getElementById('live-total').innerText = Math.round(total);
        const st = document.getElementById('live-status');
        if (total >= getPassCriteria() && (students[activeIdx].n !== "" || total > 0)) { st.innerText = "PASS"; st.style.backgroundColor = "var(--zong-green)"; }
        else { st.innerText = "FAIL"; st.style.backgroundColor = "var(--danger)"; }
    }

    function renderTable() {
        let app = 0, pass = 0, fail = 0; 
        const passLimit = getPassCriteria();
        const studentsPerPage = 30;
        const filledStudents = students.slice(0, maxReachedIdx + 1);
        
        filledStudents.forEach(s => {
            let total = s.m.reduce((a, b) => a + (parseFloat(b) || 0), 0);
            if(s.n.trim() !== "" || total > 0) {
                app++; if(total >= passLimit) pass++; else fail++;
            }
        });

        const container = document.getElementById('dynamic-print-container');
        container.innerHTML = ''; 

        for (let i = 0; i < filledStudents.length; i += studentsPerPage) {
            const chunk = filledStudents.slice(i, i + studentsPerPage);
            const pageDiv = document.createElement('div');
            pageDiv.className = 'print-page';
            
            const subjects = getSubjects();
            const tableRows = chunk.map((s, index) => {
                let total = s.m.reduce((a, b) => a + (parseFloat(b) || 0), 0);
                let isFail = (s.n.trim() !== "" || total > 0) && (total < passLimit);
                return `<tr><td>${i+index+1}</td><td style="text-align:left">${s.n}</td><td style="text-align:left">${s.f}</td>${s.m.map((m, mi) => `<td>${isLocked(mi)?'-':(m||'')}</td>`).join('')}<td class="total-cell">${Math.round(total) || 0}${isFail ? '<span class="fail-text">FAIL</span>' : ''}</td></tr>`;
            }).join('');

            pageDiv.innerHTML = `
                <div class="a4-head">${document.getElementById('edit-title').value}</div>
                <div class="a4-info-bar">
                    <span>SCHOOL: ${document.getElementById('edit-school').value}</span>
                    <span>CLASS: ${currentClass}</span>
                    <span>SECTION: ${document.getElementById('sectionInp').value.toUpperCase()}</span>
                    <span>EXAM: ${currentMode === '1st' ? '1ST' : 'FINAL'} SEM (${Math.round(WEIGHT*100)}%)</span>
                </div>
                <table>
                    <thead><tr><th>RN</th><th style="width:150px">STUDENT NAME</th><th style="width:150px">FATHER NAME</th>${subjects.map(s => `<th>${s}</th>`).join('')}<th class="total-cell">TOTAL</th></tr></thead>
                    <tbody>${tableRows}</tbody>
                </table>
                ${(i + studentsPerPage >= filledStudents.length) ? `
                    <div class="print-stats-bottom">
                        <span>Students Appeared: ${app}</span><span>Pass: ${pass}</span><span>Fail: ${fail}</span><span>Pass %: ${app > 0 ? Math.round((pass/app)*100) : 0}%</span>
                    </div>
                    <div class="signature-row">
                        <div class="sig-box">${document.getElementById('sig1-edit').value}</div>
                        <div class="sig-box">${document.getElementById('sig2-edit').value}</div>
                        ${["6TH", "7TH", "8TH"].includes(currentClass) ? `<div class="sig-box">${document.getElementById('sig3-edit').value}</div>` : ''}
                    </div>
                ` : `<div style="text-align:right; font-size:9pt; margin-top:10px;">...Continued</div>`}
            `;
            container.appendChild(pageDiv);
        }
    }

    function updateData(k, v) { students[activeIdx][k] = v; renderTable(); saveToDisk(); }
    function saveToDisk() { localStorage.setItem(getStoreKey(), JSON.stringify(students)); }
    function changeClass(v) { currentClass = v; activeIdx = 0; init(); }
    function changeMode(v) { currentMode = v; activeIdx = 0; WEIGHT = (v === 'Final') ? 1.0 : 0.45; updatePercOptions(); init(); }
    function changePerc(v) { PASS_THRESHOLD = parseFloat(v); updateLiveTotal(); renderTable(); }
    function nav(d) { let next = activeIdx + d; if(next >= 0 && next < 100) load(next); }
    function deleteWholeClass() { if(confirm("Clear class data?")) { localStorage.removeItem(getStoreKey()); activeIdx = 0; init(); } }
    function clearCurrentRow() { students[activeIdx] = {n:'', f:'', m:Array(9).fill('')}; load(activeIdx); renderTable(); saveToDisk(); }

    window.onload = () => { updatePercOptions(); init(); };
</script>
</body>
</html>
